{% extends "layouts/default.html" %}
{% block title %}Welcome to Caveman2{% endblock %}
{% block content %}
<div class="container">
        <div id="control">
                <button type="button" id="play" onclick="play()">▶</button>
                <button type="button" id="stop" onclick="stop()">■</button>
                <button type="button" id="repeat" onclick="repeat()">repeat</button>
                <button type="button" id="shuffle" onclick="shuffle()">shuffle</button>
        </div>
        <div id="playlist-container">
                <label for="playlist">Play list</label>
                <form>
                        <select id="playlist" name="PLAY-LIST" size="1" multiple>
                                <option></option>
                        </select>
                </form>
        <script>
                function eltInput () {
                        let index = document.getElementById("playlist").options.selectedIndex;
                        let option = document.getElementById("playlist").options[index];
                        option.text = prompt();
                }

                function play (){
                        let firstp = true;
                        for (let option of document.getElementById("playlist").options){
                                if (firstp){
                                        let http = new XMLHttpRequest();
                                        http.open("post", "/play/file", true);
                                        http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                                        http.send("FILE=" + option.text);
                                        firstp = false;
                                } else {
                                        let http = new XMLHttpRequest();
                                        http.open("post", "/play/push", true);
                                        http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                                        http.send("FILE=" + option.text);
                                }
                        }
                }

                function stop () {
                        let http = new XMLHttpRequest ();
                        http.open ("get", "/stop", true);
                        http.send ();
                }

                function shuffle () {
                        let http = new XMLHttpRequest ();
                        http.open ("get", "/toggle/shuffle", true);
                        http.send ();
                }

                function repeat () {
                        let mode = document.getElementById("repeat");
                        let modeCircle = { "repeat":"one", "one":"all", "all":"false"};
                        let nextMode = modeCircle[mode.textContent];
                        let http = new XMLHttpRequest ();
                        http.open ("post", "/repeat", true);
                        http.setRequestHeader ("Content-type", "application/x-www-form-urlencoded");
                        http.send ("MODE=" + nextMode);
                        mode.textContent = nextMode
                }
        </script>
        </div>
</div>
{% endblock %}
